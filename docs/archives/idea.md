# README修正の指示書（Step1＝“自動化しない”を前提）

前提：Step1は**行路の手作り＋人の手割付**に徹し、ソルバー等の自動最適化は**一切実行しない**。ただし、**警告・効率指標の表示**は行う。対象ドキュメントはリポジトリ直下の`readme.md`。本文の章立て・文体は現行のまま踏襲しつつ、以下の“置換・追記・削除”を行う。

## 1. 目的（What）—冒頭段落の置換

* 置換案（1段落）
  「本プロジェクトは**Step1として“人が最適化”する運用**を支援する。GTFSを読み込んで**行路（Block）を直観的に手作り**し、**従業員（Duty）を手で割り付け**、**警告と効率指標を提示**して判断を速くする。**自動最適化（探索・ソルバー）はStep2以降で段階導入**し、Step1では**一切自動確定を行わない**。」

## 2. スコープ／非スコープ—明確化（追記＋強調）

* スコープに**太字で追記**：
  「**Step1では“自動でブロックやDutyを決めない”。候補提示・警告表示のみ。**」
* 非スコープを**冒頭に昇格・強調**：
  「**自動最適化（探索・数理計画・CP-SAT/MIP）は全て非スコープ（Step2対象）**。」

## 3. 用語—最小拡張の定義（追記）

* 追記：
  「**二面ビュー**：同一データを**縦軸=vehicle_id（車両）**と**縦軸=employee_id（従業員）**で切替表示。
  **交代所（Relief Point）**：交代・休憩を取りやすい地点の集合。
  **イベント（Event）**：行路とDutyの交差実体（営業/回送/出入庫/休憩/点検/待機）。」

## 4. ユーザーストーリー—“人手最適化”を明記（置換）

* 既存の3本を保持しつつ、以下を**追加**：
  「運用担当者として、**警告と指標を見ながら**自分で連結や割付を判断したい（**システムは保存を妨げない**）。」

## 5. コア機能（How）—UI・機能の再定義（置換＋追記）

* 「3) 行路の手作り（Blockエディタ）」は現行を維持し、次を**追記**：
  「**二面ビュー切替**：

  * **Vehicleビュー**（縦=vehicle_id）：理想行路を作る主画面。
  * **Employeeビュー**（縦=employee_id）：割付・休憩確認の主画面。
    どちらで編集しても相互に即時反映する。」
* 「4) 交番の作成（Dutyエディタ）」の重複節を**1つに統合**し、次を**明記**：
  「**自動割付は実装しない**。未割付は“未割当グループ”へ集約し、ドラッグで当て込む。」
* 「6) 逸脱の警告」配下に**区分ラベル**を追加：

  * **Hard違反（赤）**：連続運転超過／休憩不足／拘束・深夜帯違反／資格・所属不整合。
  * **Soft警告（黄）**：長大ブロック／デポ越境過多／給油・点検余白不足／交代所未活用。
  * 原則は既記載どおり**「保存は可能」**を維持。
* **効率指標の固定表示**（新設小節）
  「上部ダッシュに下記を常時表示：

  * 回送比率[%]、レイオーバー確保率[%]、交番可用率[%]、Hard/Soft警告件数。
    値の意味と計算式をツールチップに記載。」

## 6. データ入出力—CSVスキーマの最小追記

* `blocks.csv`：`block_id, sequence, trip_id, start_time, end_time, vehicle_id(optional)`
* `duties.csv`：`duty_id, employee_id, block_id, start_time, end_time`
* **events（内部表）**を仕様欄に**参考として追記**：
  `event_id, event_type(revenue|deadhead|pull-out|pull-in|break|inspection|standby), start_time, end_time, trip_id?, block_id?, vehicle_id?, employee_id?, depot_id?, relief_point_id?, violation_flags, geometry?`
  （将来のソルバー導入を見越した**共通イベントモデル**だが、Step1ではUI同期と警告生成のみで利用）

## 7. ミニマム運用フロー—Step1向けに順序を微修正（置換）

* 4. を次の表現に**置換**：
     「**4) 連結ブロックの作成（手動／貪欲サジェスト）**
     UIで端点をつなぐ。候補が複数あれば**“提案のみ”**（自動決定なし）。未連結・警告は即時表示。」
* 5. の見出しを**「労務ルールの警告解消（手動）」**に変更。
* 6. の最後に**“未割付ゼロは必須ではない（保存可）”**を追記。

## 8. 警告の原則—一文を強調（追記）

* 追記：
  「**Step1の原則：どの警告でも保存を妨げない。判断責任は人。**」

## 9. 受け入れ基準（DoD）—Step1仕様に揃える（置換）

* 置換案：

  1. GTFS読込→ルート個別表示ができる。
  2. UIで便の端点を接続してブロック作成→**直後に該当警告が表示**される。
  3. Dutyビューで従業員を**手動で割付**→交番表CSV出力ができる。
  4. **Hard/Soft警告が存在しても保存・出力できる**（CSVに警告要約列を含める）。
  5. Vehicle/Employeeの**二面ビュー切替**ができ、編集は相互に同期する。

## 10. “最適化方針（ミニマム）”節—**Step2へ移設**（削除→末尾に脚注）

* 現行の最適化三段（貪欲→近傍→小規模MIP）は**本文から削除**。
* README末尾に“**Step2計画（参考）**”として**脚注化**し、「**本バージョンでは実行しない**」と明記。

## 11. プライバシーと運用（新設）

* 新設小節：
  「**個人情報は匿名IDで扱う**。`employee_id`は名寄せテーブルで外部保管し、アプリは参照しない。監査ログは**操作と判定のみ**を残し、個人特定情報は含めない。」

## 12. スクリーン構成のスケッチ（新設）

* 簡潔に3画面を**箇条書き**で追記：

  1. **Explorer**：ルート一覧／個別（地図＋タイムライン）。
  2. **Blocks**：Vehicleビュー中心。端点連結・警告表示・効率ダッシュ。
  3. **Duties**：Employeeビュー中心。ドラッグ割付・Hard/Soft警告の解消。

## 13. KPI記述—“Step1で測る指標”に統一（微修正）

* 「検証時間50%削減／違反検知70%短縮／労務違反ゼロ」の**“検証時間・検知時間のUIログ計測方法”**を1文追記。
  例：「操作ログから**連結→警告確認→保存**までの所要を自動集計。」

---

### 仕上げ時の注意

* 現在の「重複している“交番の作成（Dutyエディタ）”節」は**一つに統合**。
* “貪欲連結”は**サジェスト表現に限定**し、**自動確定の記述は削除**。
* すべての“最適化”という語は**Step2脚注に退避**。本文は**“人が最適化するUI”**に統一。

以上。これでREADMEは**Step1＝“自動化しない”**に完全準拠し、現場導入の合意文書として一貫した内容になります。
