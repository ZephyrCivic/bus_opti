# MVP 実行TODO（SSOT）

## 北極星（詳細）
本プロダクトは、バス事業者の計画業務（行路＝Block交番＝Duty）を支援するSaaSのMVPです。Step1では、既存のGTFSを読み込み、選んだ路線を地図とタイムラインで可視化し、便の連結（行路）と交番をドラッグ操作で手作りします。作業中は、休憩不足連続運転超過未割当などの警告と、回送比率などの効率指標を表示しますが、保存は決して妨げません。GTFSにない情報（車両ドライバー倉庫交代所労務ルール）はCSVで補完し、現場の判断で前に進めます。画面は「車両軸（Vehicle）」と「ドライバー軸（Driver）」を切り替えられ、どちらで編集しても即時に同期されます。Step2では、蓄積したデータを基に、最適化ソルバで自動配置へ拡張します（本MVPでは実行しません）。

## このファイルの使い方
- 下のチェックボックスを上から順に消化する。
- 各項目は「参照ドキュメント」「検証コマンド」「成果物/DoD」を含む。

## TODO 一覧（上から順に実行）
- [ ] 0. 準備/GTFSヘルスチェック
  - 参照: docs/specs/requirements-blocks-duties.md
  - 検証: `npx tsx tools/gtfsHealthCli.ts <gtfs.zip>`（Blockless/時刻延長を確認）
  - 成果物/DoD: 重大エラー0、警告は記録（logs/）し次工程に反映

- [ ] 1. Explorer（取り込み/路線選択/地図＋タイムライン）
  - 参照: docs/specs/ui-mock.md, docs/specs/timeline-interactions.md
  - 検証: `make preview` → `make generate-snapshots`（閾値0.5%）
  - 成果物/DoD: ルート個別が正順描画、パン/ズーム応答<1s

- [ ] 2. Blocksエディタ（端点連結＝手動／提案のみ）
  - 参照: docs/specs/block-ui-redesign.md, docs/specs/requirements-blocks-duties.md
  - 検証: スナップショット合格≤0.5%、`npm run devtools:landing-hero`
  - 成果物/DoD: 連結/解除/並び替えと差分表示が即時

- [ ] 3. Dutiesエディタ（ドラッグ割付／未割当グループ）
  - 参照: docs/specs/duty-editing.md, docs/specs/duty-editing.addendum.md
  - 検証: スナップショット、Undo/Redo 10段
  - 成果物/DoD: 割付/解除/移動が可能、`duties.csv`プレビュー

- [ ] 4. 警告（Hard/Soft）即時表示と内訳
  - 参照: docs/specs/requirements-blocks-duties.md
  - 検証: 編集→<1sで反映、内訳に根拠リンク
  - 成果物/DoD: Hard/Soft件数一致、保存は非ブロック

- [ ] 5. 効率指標ダッシュ（回送/レイオーバー/可用率）
  - 参照: docs/specs/kpi-ux-panel.md
  - 検証: 値が期待値±1%、ツールチップに式
  - 成果物/DoD: 指標固定表示、編集で再計算

- [ ] 6. 二面ビュー切替と編集同期（Vehicle/Driver）
  - 参照: docs/specs/ui-mock.md, docs/specs/timeline-interactions.md
  - 検証: 切替/編集で200ms以内に同期
  - 成果物/DoD: 双方向編集が即時反映

- [ ] 7. CSV入出力（blocks/duties）＋警告要約列
  - 参照: docs/specs/diff-export-scope.md, docs/specs/diff-export-rollout.md, docs/specs/file-write-audit.md
  - 検証: Export→Import→Exportが一致（冪等）
  - 成果物/DoD: 警告要約列を含むCSV出力と監査ログ

- [ ] 8. 設定UI（Web主/CSV補助）折返し/交代所/Depot/労務
  - 参照: docs/specs/settings-ui.md, docs/templates/*.template.csv
  - 検証: 由来バッジ表示、ドラフト→適用→ロールバック
  - 成果物/DoD: 設定が警告/指標に即時反映

- [ ] 9. 出力時確認（非ブロッキング）
  - 参照: docs/specs/output-confirmation.md
  - 検証: 公開/CSV出力前に要約ダイアログ（Hard/Soft/未割付/指標）、続行可
  - 成果物/DoD: 監査ログに要約値と実行者を記録

- [ ] 10. 監査ログとプライバシー
  - 参照: docs/specs/file-write-audit.md, readme.md（プライバシー）
  - 検証: 主要操作100%記録、PIIなし
  - 成果物/DoD: 期間保存の監査レコード

- [ ] 11. KPI計測（UIログ）と週次レポート
  - 参照: docs/specs/kpi-ux-panel.md
  - 検証: 「連結→警告確認→保存」所要を自動集計
  - 成果物/DoD: 週次ダッシュ、CSVエクスポート

- [ ] 12. ドキュメント整備（README/Plans/テンプレ）
  - 参照: readme.md, 本ファイル
  - 検証: 参照リンク死活=0、手順再現可
  - 成果物/DoD: SSOT整合クリア

## 実行コマンド索引
- ビルド/プレビュー: `make preview`
- UIスナップショット: `make generate-snapshots`（閾値0.5%）
- DevToolsヒーロー確認: `npm run devtools:landing-hero`
- GTFSヘルスチェック: `npx tsx tools/gtfsHealthCli.ts <zip>`

注記（Step1原則）
- 保存は常に可能。Hard/Softと指標は提示、出力時は非ブロッキング確認のみ。

---

# Exec Plan リンク
このタスクのExec Planは docs/exec-plans/ui-snapshots.md を参照してください。
