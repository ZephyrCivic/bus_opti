# Import UX 統一 — ワイヤーフレーム（モック）

最終更新: 2025-10-22

本ドキュメントは「実装なし」でUIの形と振る舞いを共有するためのテキストモックです。確定後に Exec Plan を起票して実装します。

## 画面1: 読み込みメニュー（ImportView 初期表示）

```
┌ 読み込みメニュー ───────────────────────────────────────────────┐
│ 説明: 新規開始（GTFS）または途中から再開（保存データ）を選びます。   │
│                                                                  │
│ [ GTFSを読み込む ]   — ZIP (stops/trips/stop_times/…) から新規開始         │
│                                                                  │
│ [ 保存データから再開 ] — 以前の作業を開く（プロジェクトJSON / 取込結果JSON） │
│                                                                  │
│ 備考: 選択後は共通の「取込サマリー」に遷移します。                       │
└──────────────────────────────────────────────────────────────────┘
```

- ボタン: プライマリー（GTFS）、セカンダリー（保存データ）
- ファイル選択: 押下で OS ファイルダイアログ（Drag & Drop も許可）
- 例外: 不正形式や必須ファイル欠落は共通エラー（後述）
- フォーカス順: 見出し → 説明 → ボタン（上→下）→ 備考 → エリア外。
- スクリーンリーダー: ボタンに `aria-describedby` で説明を紐付け。

## 画面2: 取込サマリー（GTFS/保存どちらも共通）

```
┌ 取込サマリー ───────────────────────────────────────────────┐
│ Imported at: 2025-10-22 10:30    Source: feed_xxx.zip              │
│                                                                      │
│ 指標 (table):                                                         │
│   Stops | Trips | Routes | Service IDs                               │
│   1234  | 5678  |   42   |    11                                     │
│                                                                      │
│ 注意 (alert):                                                         │
│   ・任意ファイル欠落: shapes.txt                                     │
│   ・24時超表記あり: stop_times 12件                                  │
│                                                                      │
│ （任意）路線の絞り込み                                               │
│   [検索欄] [全選択] [全解除]                                         │
│   [ route_001 ] [ route_002 ] [ route_003 ] … （横並び・折返し）      │
│                                                                      │
│   地図プレビュー（強調表示）                                         │
│   ─ 選択された route_id に対応するshapeをハイライト（実装は後続）       │
│                                                                      │
│ [ Explorer を開く ]                                                  │
└──────────────────────────────────────────────────────────────────────┘
```

- 初期状態: 全路線選択
- リスト操作: クリックでトグル選択、検索で絞り込み表示
- 地図プレビュー: 選択路線のshapeをハイライト（実装は別Exec Planで対応）
- 次の導線: 「Explorer を開く」 → 上部ナビで Blocks/Duties へ
- Explorer ボタンは有効時/無効時で aria 属性を切り替え、無効時は補足テキストを即時読み上げ。
- 路線リストはチェックボックス群として表現し、矢印キーで移動可能。

## 保存系アクション（導線）
- 採用: A案（左ナビ「差分・出力」に集約）
- Import 直後は前面に出さない。
- 補助（任意）:
  - 取込サマリー下ヒント: 「保存・出力は左の『差分・出力』から実行します」
  - 初回編集後のワンタイムチップ: 「作業の続きのために保存できます → 差分・出力」
- 差分・出力タブに遷移した際は、保存アクションカードへフォーカスリングを設定して認知負荷を軽減。

## 共通エラーパターン（表記統一）
- ZIP不正: 「ZIPファイルの読み込みに失敗しました。ファイルが破損していないか確認してください。」
- 必須欠落: 「必須ファイルが不足しています: stops.txt, trips.txt, stop_times.txt」
- 保存JSON不正: 「保存ファイルの読み込みに失敗しました。内容をご確認ください。」
- 失敗時はアラート領域にフォーカスし、Escape キーで閉じられるよう実装。

## 文言（たたき台）
- 読み込みメニュー: 「新規開始（GTFS）」「保存データから再開」
- 取込サマリー: 「指標」「注意」「（任意）路線の絞り込み」「Explorer を開く」
- 保存系: 「取込結果を保存（JSON）」「プロジェクト保存（JSON）」

## インタラクション仕様（要件）
- 初期は全選択。選択が0件になった場合は「Explorer を開く」を無効化（要検討）。
- 検索は route_id/短名/長名を対象。
- 地図プレビューはズーム/パン可。選択変更でハイライトを差し替え（後続実装）。
- ボタン無効化時は `aria-disabled="true"` を付与し、フォーカスを保持したまま説明テキストに遷移できる。

## 受入基準（仕様段階）
- 2導線から同一サマリーに遷移する文言・構成が確定している。
- 路線絞り込みは任意で、初期値が全選択であることを明記。
- 保存系アクションの導線はA/B案として提示済み。
- アクセシビリティ配慮の観点での振る舞いが具体化されている。

## 次のステップ（実装前タスク）
- PO合意 → Exec Plan作成（Import UX 統一 実装）
- 実装後に `make generate-snapshots` で見た目回帰を確認
- Route 絞り込みのハイライト仕様を context7 ドキュメントで再確認し、性能要件を追記。
