<!--
  docs/specs/distribution-approval.md
  場所: docs/specs/
  目的: 社内 / 外部向け配布物の優先度と承認フローを明文化し、監査可能な手順を共有する。
  背景: TODO「社内 / 外部向け配布物の優先度と承認フローの確認」DoD を満たすため。
-->

# 配布物優先度と承認フロー（2025-10-08）

## 背景
- Diff / Export 機能の拡張に伴い、社内運用チームと顧客向けに配布する成果物が増加している。
- 先行タスクで整理したロールアウト計画（`docs/specs/diff-export-rollout.md`）と連携し、配布物の優先順位と承認手順を明確にする必要がある。
- コンプライアンスと監査要件を満たすため、配布前の確認項目を標準化する。

## 対象配布物と優先度
1. **社内運用パック（P1/最優先）**  
   - 内容: `docs/diff-baselines/` 最新スナップショット、Dashboard KPI スクリーンショット、設定差分レポート。  
   - 用途: Scheduling Ops が週次レビューで使用。  
   - 更新頻度: 週次（月曜 10:00 JST 締め）。
2. **社内トレーニングパック（P2）**  
   - 内容: デモ用 CSV（`docs/demo/`）、操作手順スライド、FAQ 草稿。  
   - 用途: 新任オペレータ研修、サポートチーム勉強会。  
   - 更新頻度: フェーズ移行時 or サービス改訂時。
3. **外部顧客リリースパック（P3）**  
   - 内容: Blocks/Duties CSV・JSON エクスポート、差分レポート、リリースノート草稿、サポート問い合わせ先。  
   - 用途: 顧客テナントへの公開。  
   - 更新頻度: フェーズ2以降、公開ごと。

## 承認フロー
| ステップ | 役割 | 対象配布物 | 期限 | チェック内容 |
| --- | --- | --- | --- | --- |
| 1 | 作成者 (Codex) | 全配布物 | 配布前営業日 -2 | 内容更新、ファイル名・バージョン確認、`npm test` 合格ログ添付 |
| 2 | QA リード | 社内運用/外部顧客 | 配布前営業日 -1 | テスト結果レビュー、Diff 差分検証、機密情報マスク確認 |
| 3 | Ops マネージャ | 社内運用/外部顧客 | 配布日 前日 17:00 JST | ロールアウト計画と整合、エスカレーション先確認 |
| 4 | コンプライアンス担当 | 外部顧客のみ | 配布日 当日 09:00 JST | 契約上の配布範囲・権限設定 (`config.py` roles) の最終承認 |

## 承認前チェックリスト
- `docs/diff-baselines/` に最新履歴があり、30件超の古いスナップショットはアーカイブ済み。
- `config.py` の `roles.downloadExport` 設定が対象テナントに適用されていることを Ops が確認。
- リリースノート草稿に FAQ・サポート連絡先・既知の制約が記載されている。
- `tests/**/*.test.ts` で関連テストが通過したログ（ハッシュ付き）を添付。
- 外部パックの場合、顧客固有データを含むファイルへ匿名化処理を適用し、実施者と日時を記録。

## コミュニケーションと記録
- 承認済み配布物は `docs/releases/`（フェーズ3で運用開始予定）にフォルダを作成し、README に配布対象・承認者・公開日時を記入。
- 承認ログは Slack `#duty-diff-support` に投稿し、メッセージスレッドで承認ステータスを追跡。
- 外部顧客向けメール送付時は Ops マネージャと CS リードを CC に追加し、送付済みメールを PDF で保管。

## 関連ドキュメント
- `docs/specs/diff-export-rollout.md`
- `docs/DECISIONS_2025-10-06.md`
- `docs/TODO.md`
