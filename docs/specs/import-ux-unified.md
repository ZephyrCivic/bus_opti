# Import UX 統一（仕様・ワイヤー草案）

最終更新: 2025-10-22

## 目的
- 業務フローを「新規開始（GTFS読み込み）」と「途中から再開（保存データ読み込み）」の2導線で統一する。
- どちらの導線でも同一の「取込サマリー」コンポーネントで現在地を示し、後続の作業（Explorer/Blocks/Duties）へスムースに遷移させる。
- UI テキスト・アクセシビリティ要件・影響範囲を共通理解できる粒度まで明文化し、実装 Exec Plan の土台を整備する。

## 背景
- 2025-10-22 時点のユーザーフィードバック: 「GTFS からのプロジェクト開始」と「保存データからの再開」を同列に扱いたい。
- 既存 ImportView は GTFS 読み込みを前提とした導線が強く、保存データの再開はメニュー深部にあり発見性が低い。
- 複数の保存形式（プロジェクトJSON / 取込結果JSON）の説明が不足しており、初回ユーザーが混乱しやすい状態。

## 用語
- 保存データ（取込結果JSON）: GTFSを解析した結果のみをJSON化したバックアップ。
- プロジェクトJSON: 保存データ + 手動入力（デポ/交代/ドライバー等）を含む再開用データ。

## 入口（読み込みメニュー）
- 見出し: 読み込みメニュー
- ボタン1: GTFSを読み込む
  - 説明: ZIP (stops/trips/stop_times/… を含む) から新規プロジェクトを開始します。
  - 操作: ファイル選択 or D&D
- ボタン2: 保存データから再開
  - 説明: 以前の作業（プロジェクトJSON / 取込結果JSON）を開きます。
  - 操作: ファイル選択
- アクセシビリティ: 両ボタンは `aria-describedby` で説明テキストと連動し、キーボード操作で上下移動が可能。
- エラー表示: アラート領域を共通利用し、フォーカスを自動で移動させる。

## 取込サマリー（共通）
- 見出し: 取込サマリー
- 情報: Imported at, Source name, 指標テーブル（Stops/Trips/Routes/Service IDs）, 注意（任意ファイル欠落・24時超など）
- アクション:
  - （任意）路線の絞り込み: 初期は全選択。リストで選択すると地図プレビューで強調表示（実装は後続Exec Plan）。
  - 次へ: Explorer を開く（Blocks/Dutiesへは上部ナビから遷移）
- マイクロコピー: 例「Imported at: 2025-10-22 10:30／Source: feed_xxx.zip」「注意: 24時超表記あり 12件」
- データ欠損時はテーブルに `—` を表示し、警告欄で不足項目を列挙。
- Explorer ボタンは選択路線が0件のとき `disabled` + 補足メッセージを表示。

## 保存系アクションの導線（A案採用）
- 決定: 2025-10-22 時点で A案（左ナビ「差分・出力」に集約）を採用。
- ImportView では前面に出さず、以下の補助のみを検討:
  - 取込サマリー下に小さなヒント文: 「保存・出力は左の『差分・出力』から実行します」
  - 初回手動編集を検知した際の一度きりチップ: 「作業の続きのために保存できます → 差分・出力」
  - 差分・出力タブ内のアクション:
    - 取込結果を保存（JSON）
    - プロジェクト保存（JSON）

## アクセシビリティ要件
- フォーカス順序は視覚的配置と一致させ、読み込みメニュー→サマリー→オプション→次ボタンの順に移動する。
- 全ボタンに `aria-label` または明示テキストを付与し、スクリーンリーダーで行先が分かるようにする。
- 指標テーブルは `<table>` 構造を保持し、ヘッダーセル (`scope="col"`) を設定する。
- 警告メッセージは `role="alert"` を付与し、表示時にフォーカスを移動して即座に読み上げる。
- 路線の絞り込みリストはチェックボックスグリッドとして実装し、キーボードで左右上下に移動可能とする。

## ワイヤーフレーム（テキスト）

1) 読み込みメニュー（ImportView／初期表示）
```
[ GTFSを読み込む ] — ZIPから新規プロジェクト開始
[ 保存データから再開 ] — 以前の作業を開く（プロジェクト/取込結果）
```

2) 取込サマリー（GTFS/保存どちらでも同一）
```
┌ 取込サマリー  [Imported at: 2025-10-22 10:30 / Source: feed_xxx.zip]
│  指標: Stops / Trips / Routes / Service IDs
│  注意: 欠落ファイル/24時超 等
│
│  （任意）路線の絞り込み: [全選択][ route_1 ][ route_2 ] ... （検索）
│  地図プレビュー（強調表示）
│
│  [ Explorer を開く ]
└─────────────────────────────────────────
```

## 受入基準（仕様段階）
- 2導線（GTFS / 保存データ）で同一のサマリー構成を提示する文案が確定している。
- サマリー下部の「任意の路線絞り込み」UIはモックで表現され、初期は全選択であることが明記されている。
- 保存系アクションの導線（A/B案）が比較可能な形で提示されている。
- アクセシビリティ要件と影響範囲が明文化され、レビュアーが抜け漏れを識別できる状態である。

## 影響範囲
- 対象コンポーネント: `ImportView`, `ImportSummaryCard`, `DiffExportNav`
- 間接影響: Explorer への遷移導線、Diff/Export タブの文言調整。
- テレメトリ: 「Explorer を開く」ボタン押下イベントのラベル再検討（サマリー導線統一後）。

## 非機能（影響）
- 実装時は ImportView のUI分岐とテキスト変更が中心。既存解析ロジックは再利用。
- 路線絞り込みの実装は別Exec Plan（パフォーマンス検証・Mapハイライト・テーブル再集計）。

## 次アクション
- 本仕様に対するPO合意を取得 → Exec Plan: Import UX 統一（実装）を起票。
- 仕様モックを `make generate-snapshots` で簡易検証（モックUIのみ）。

付録（モック）: docs/specs/import-ux-unified.mock.md
