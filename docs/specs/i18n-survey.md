<!--
  docs/specs/i18n-survey.md
  場所: docs/specs/
  目的: i18n 対応の範囲と優先言語、技術的前提を整理する調査メモ。
  背景: TODO「i18n 対応の調査（対応範囲・優先言語の整理）」の DoD を満たすため。
-->

# i18n 対応調査メモ（2025-10-08）

## 背景
- 現状 UI は日本語中心で固定文言が散在しており、外部顧客向けに英語対応の要望が増加している。
- CSV / JSON エクスポート、Diff / Dashboard などのテキストも翻訳対象となるため、アプリ全体の対応範囲を事前に把握する必要がある。
- Playwright / Chrome DevTools CLI を活用したスナップショット検証への影響も想定する。

## 対応範囲と優先言語
- **優先度P1**: 日本語 (既存) / 英語 (新規)  
  - 対象: UI 全文言、ダッシュボード指標、エラーメッセージ、エクスポートメタデータ。  
  - フォーマット: ICU MessageFormat 準拠を検討。  
- **優先度P2**: 中国語(簡体字)  
  - 対象: 外部リクエストあり。先行して手動翻訳ガイドラインを作成。  
  - スコープ: UIラベルとドキュメント（README のサマリ）を最小限翻訳。  
- **除外（今回）**: 音声読み上げ、右から左の言語 (Arabic/Hebrew)。

## 技術方針（暫定）
- ライブラリ候補: `@lingui/core` or `react-intl`（現在の依存とバンドルサイズを比較して決定）。  
- メッセージ管理: `src/locales/<lang>.json` を生成し、`config.py` に既定言語と fallback を追加。  
- ビルド対応: Vite プラグインでメッセージ抽出を自動化、`npm test` 前に `npm run extract:i18n` を追加予定。  
- テスト: `tests/ui.timeline.render.test.tsx` 等のスナップショットは多言語モードでの差分検証を追加し、許容差分を明記。

## 実装ロードマップ案
1. **設計整理 (0.5日)**  
   - ライブラリ比較、メッセージ抽出フロー設計、`config.py` の言語設定項目追加案をレビュー。  
2. **基盤導入 (2日)**  
   - i18nライブラリ導入、`App.tsx` での言語プロバイダ実装、主要ビューのキー化。  
3. **翻訳整備 (2日)**  
   - 日本語・英語リソース作成、CSVヘッダーなどの静的文言もキー化。  
4. **テスト・ドキュメント更新 (1日)**  
   - スナップショット更新、README に言語切替手順追加、Context7 CLI で翻訳ガイドを取得。  
5. **P2 言語評価 (Backlog)**  
   - 中国語翻訳ベンダーの選定、CI への lint 追加検討。

## リスクと観点
- メッセージキー漏れによるフォールバック混在。 → CIで未翻訳キー検出を実施。  
- エクスポートファイルのヘッダー翻訳で互換性が失われる可能性。 → データ列名は英語固定、UI表示のみ翻訳。  
- Playwright / Chrome DevTools CLI のスナップショット差分増加。 → ロケール別の基準画像を `docs/screenshots/` に保持。

## 関連資料
- `docs/specs/diff-export-rollout.md`（外部公開時の言語要件に言及）  
- `docs/DECISIONS_2025-10-06.md`（KPI 警告メッセージの承認フロー）  
- `docs/TODO.md`
